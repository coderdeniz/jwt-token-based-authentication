Cookie-based auth: web uygulaması dış kaynaktan beslenmiyorsa db'den alıyorsa ve üyelik sistemi inşa etmek istiyorsak bu cookie bazlı kimlik doğrulama oluyor. Token'a burda ihtiyaç kalmıyor.

Token-based auth: Client token dağıtıcı api'ye istek atar token'ini alır, client kendi içerisinde bu tokeni tutar ve erişmek istediği servise bu token ile gider.
  Kullanıcı gerekmeyen durumlarda, token dağıtıcı, isteği atmaya yetkisi olacak client için özel yetki tanımlayacak client bu token ile yetkisi olan api'ye istek atabilecek.
  Kullanıcı olan durumlarda ise token dağıtıcı kendi içerisinde user'i kontrol eder varsa token döner.
  Not: token dağıtıcı da kendi içerisinde token kontrol edebilir.


 JWT: IETF tarafından sunulan standart bir token biçimidir. Bu tokeni kullanarak kimlik doğrulama ve yetkilendirme işlemlerini gerçekleştirebiliriz.
 3 parçadan oluşur; header, payload ve signature
 Json data döner. 
 Payload içerisinde sub alanında genelde kullanıcının id'si tutulur. Özneyi belli eder.

 Simetrik şifeleme: Şifrelenip imzalanan tokenla aynı şifre ile doğrulanıyorsa buna simetrik denir.
 Asimetrik şifreleme: Private ve public key vardır. Tokeni private key ile imzalıyoruz public key ile doğruluyoruz. İmzalama ve doğrulama farklı key'ler ile yapılıyor.

 Jwt okunur decode edilir ama decode edilmiş yapıda bir şey değiştiğinde encode geri yapılamaz keyi bilmesi lazım.

 jwt base64 ile decode ediliyor.

 Cookie bazlıda cookiyi başka biri alırsa sonsuza kadar kullanabilirken, token için bu durum expire süresi kadardır.

 Payload'da user pass gibi bilgileri paylaşmamak lazım onun yerine id, email, rol gibi alanlar taşınabilir.

 Payload'da tutulan alanlar OAuth2.0 protokolüne(kurallar bütünü) göre birer claim oluyor. Bu kimlik yetkilendirmede görev alır.
 
 Claim, kullanıcı hakkında tutulmuş olan bilgilere denir. Kullanıcı id,email gibi alanların hepsi claim'dir.
 
 Diğer bir protokol OpenID Connect'ir bu kimlik doğrulamada görev alır.


 AccessToken: Jwt'nin kendisidir. Token isteyen api'lere request'in header'inde gönderilir. 

 RefreshToken: AccessToken expire olduğu zaman yeni bir token almak için kullanılan bir tokendir. Biçimi jwt değildir. Biçimi herhangi bir string ifadedir guid gibi belirlenebilir. Tek olması gereken unique bir değer olması. Refresh token yalnızca token dağıtan api'ye gönderilir. 

 Not: Accesstoken ömrü kısa tutulur, refreshToken ömrü daha uzun tutulur.

 Senaryo: Tokeni almış web ui, token isteyen api'ye gider, accesstoken süresi dolmuşsa api 401 döner, ui 401 aldıysa eğer tokenin ömrü dolmuş olarak yorumlar ve refresh token ile birlikte authServer'a istek atar. AuthServer'da ilgili user'a ait refresh token varsa yeni bir accessToken döner ve yeni accessToken'i alan ui, api'ye istek atar ve sonucunu alır (bu esnada kullanıcı durumdan haberdar olmaz). Eğer refreshToken'in da ömrü dolmuş olsaydı kullanıcı login'e aktarılır ve baştan yeni istekle auth'dan yeni access,refresh tokenlar alınır. 

 not: refresh tokenlar user'larla birlikte db'ye kaydedilir. accessToken db'de tutulmaz.
 
 günümüzde e-imza ssh gibi yapılar asimetrik şifreleme ile gerçekleştiriliyor.

 not: accessToken payload'da ömür bilgisi de yazar.


 ------

 SignService

 -> Yardımcı sınıf rolü oynayacak.
 -> Security Key oluşturacak

 Options Pattern

 -> appsettings.json'da tanımlanacak jwt bilgilerini ona özel class ile eşleştirme.
 -> Program.cs'de gerekli DI yapıldı bunun adına options pattern denir.

 TokenService

 -> Dış dünyaya açılmayacak.
 -> Kendi içerisinde token üretmekte görevli olacak.
 -> ITokenService implement edecek
 -> claim: token içerisinde payload'inda yer alan bilgilere denir. 
 -> audiences: claim içerisinde yer alır hangi api'lere istek atabileceğini belirler.
 -> issuer: claim içerisinde yer alır token'i kim yayınlıyor



